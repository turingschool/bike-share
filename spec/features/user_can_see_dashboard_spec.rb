require_relative '../spec_helper'

RSpec.describe 'When a user visits /station-dashboard' do

  before do
    city = City.create(name: 'Denver')

    city.stations.create!(lat: 37.329732, long: -121.90178200000001, name: 'Beth\'s Station', dock_count: 12, installation_date: Date.parse('8/8/2017'))
    city.stations.create!(lat: 2, long: 1, name: 'Sam\'s Station', dock_count: 2, installation_date: Date.parse('12/10/1986'))
    city.stations.create!(lat: 2, long: 1, name: 'Chris\' Station', dock_count: 12, installation_date: Date.parse('8/8/2016'))
    city.stations.create!(lat: 2, long: 1, name: 'Mark\'s Station', dock_count: 2, installation_date: Date.parse('8/8/2016'))

    visit '/station-dashboard'
  end

  it 'should display the total number of stations' do
    expect(page).to have_content('Total stations: 4')
  end

  it 'should display average docks per station' do
    expect(page).to have_content('Average docks per station: 7')
  end

  it 'should display the highest number of docks available at a station' do
    expect(page).to have_content('Most docks available at a station: 12')
  end

  it 'should display the names of the stations with the most docks' do
    within('li.most-docks') do
      expect(page).to have_content("Beth's Station")
      expect(page).to have_content("Chris' Station")
    end
  end

  it 'should display the fewest number of docks available at a station' do
    expect(page).to have_content('Fewest docks available at a station: 2')
  end

  it 'should display the names of the stations with the fewest docks' do
    within('li.least-docks') do
      expect(page).to have_content("Sam's Station")
      expect(page).to have_content("Mark's Station")
    end
  end

  it 'should display station that was most recently installed' do
    within('li.newest-installations') do
      expect(page).to have_content("Beth's Station")
    end
  end

  it 'should display the oldest stations' do
    within('li.oldest-installations') do
      expect(page).to have_content("Sam's Station")
    end
  end
end
